<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coding Conf 2025 - Register</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    /* Reset e configuração básica de estilos */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background: #11081A;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      position: relative;
    }

    /* Imagem de fundo com opacidade para efeito visual */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('./assets/images/background-desktop.png') no-repeat center center/cover;
      opacity: 0.25;
      z-index: -1;
    }

    main {
      max-width: 500px;
      width: 100%;
      text-align: center;
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    p {
      color: #bdbdbd;
      font-size: 0.95rem;
    }

    .form-container {
      padding: 2rem;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      text-align: left;
    }

    .input-group label {
      font-weight: 700;
      margin-bottom: 0.3rem;
      font-size: 0.9rem;
    }

    .input-group input {
      padding: 10px;
      border: 1px solid #6b46c1;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      font-size: 1rem;
      outline: none;
      transition: border 0.3s ease;
    }

    .input-group input::placeholder {
      color: #bdbdbd;
    }

    .input-group input:focus {
      border-color: #e76f51;
      outline: none;
    }

    .upload-box {
      border: 2px dashed #6b46c1;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: 0.3s;
      position: relative;
      /* Permite foco via teclado */
      outline: none;
    }
    .upload-box:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    .upload-box:focus {
      outline: 2px dashed #ffffff;
    }

    .upload-box span {
      display: block;
      margin-top: 10px;
      font-size: 0.9rem;
      color: #bdbdbd;
    }

    .upload-box input {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }

    .info-container {
      display: flex;
      align-items: center;
      font-size: 0.85rem;
      color: #bdbdbd;
      margin-top: 4px;
    }
    .info-container img {
      width: 12px;
      height: 12px;
      margin-right: 5px;
    }

    button {
      background: #e76f51;
      color: white;
      padding: 12px;
      font-size: 1rem;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s ease;
    }
    button:hover {
      background: #d65a42;
    }
    button:focus {
      outline: 2px solid #ffffff;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 10px;
    }
    .action-buttons button {
      background: transparent;
      color: white;
      border: 1px solid #6b46c1;
      padding: 6px 12px;
      font-size: 0.85rem;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }
    .action-buttons button:hover {
      background: rgba(107, 70, 193, 0.2);
    }
    .action-buttons button:focus {
      outline: 2px solid #ffffff;
    }

    /* Responsividade: Ajustes para dispositivos com largura máxima de 600px */
    @media (max-width: 600px) {
      main {
        width: 90%;
      }
      .form-container {
        padding: 1.5rem;
      }
      h1 {
        font-size: 1.5rem;
      }
      p {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <main>
    <h1>Your Journey to Coding Conf 2025 Starts Here!</h1>
    <p>Secure your spot at next year’s biggest coding conference.</p>

    <!-- Formulário de registro -->
    <form class="form-container" novalidate>
      <!-- Avatar -->
      <div class="input-group">
        <label for="avatar" id="label-avatar">Upload Avatar</label>
        <!-- Caixa de upload com tabindex para permitir foco via teclado -->
        <div class="upload-box" tabindex="0" aria-describedby="info-avatar">
          <img src="./assets/images/icon-upload.svg" width="40" alt="Upload Icon">
          <span>Drag and drop or click to upload</span>
          <input type="file" accept=".jpg,.jpeg,.png" id="avatar" aria-labelledby="label-avatar">
        </div>
        <div class="info-container" id="info-avatar">
          <img src="./assets/images/icon-info.svg" alt="Info icon">
          <span>Upload your Photo (JPG or PNG, max size 500KB).</span>
        </div>
      </div>

      <!-- Campo Nome -->
      <div class="input-group">
        <label for="name" id="label-name">Full Name</label>
        <input type="text" id="name" placeholder="Enter your name" aria-labelledby="label-name">
      </div>

      <!-- Campo Email -->
      <div class="input-group">
        <label for="email" id="label-email">Email Address</label>
        <input type="email" id="email" placeholder="example@email.com"
               aria-labelledby="label-email">
      </div>

      <!-- Campo GitHub -->
      <div class="input-group">
        <label for="github" id="label-github">GitHub Username</label>
        <input type="text" id="github" placeholder="@yourusername"
               aria-labelledby="label-github">
      </div>

      <button type="submit">Generate My Ticket</button>
    </form>
  </main>

  <script>
    // Aguarda o carregamento completo do DOM para iniciar a execução dos scripts
    document.addEventListener("DOMContentLoaded", function () {
      const avatarInput = document.getElementById("avatar");
      const uploadBox = document.querySelector(".upload-box");
      const infoContainer = document.querySelector(".info-container");
      const infoText = infoContainer.querySelector("span");
      const infoIcon = infoContainer.querySelector("img");
      const form = document.querySelector(".form-container");
      const nameInput = document.getElementById("name");
      const emailInput = document.getElementById("email");
      const githubInput = document.getElementById("github");

      let uploadedImage = null;

      // Permite abertura do seletor de arquivos ao pressionar Enter ou Espaço na upload-box
      uploadBox.addEventListener("keydown", function(e) {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          avatarInput.click();
        }
      });

      // Tratamento da seleção do arquivo para upload do avatar
      avatarInput.addEventListener("change", function (event) {
        const file = event.target.files[0];
        if (!file) return;

        // Verifica o formato permitido (JPG ou PNG)
        const validTypes = ["image/jpeg", "image/png"];
        if (!validTypes.includes(file.type)) {
          showError("Invalid image format! Only JPG or PNG allowed.");
          return;
        }

        // Verifica se o tamanho do arquivo não excede 500KB
        if (file.size > 500 * 1024) {
          showError("Image too large! Max size is 500KB.");
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          uploadedImage = e.target.result;
          displayImage(uploadedImage);
        };
        reader.readAsDataURL(file);
      });

      
      // Exibe a imagem carregada na upload-box e mostra os botões de ação.
      function displayImage(imageSrc) {
        uploadBox.innerHTML = `
          <img src="${imageSrc}" width="100" style="border-radius: 50%;" alt="Uploaded Image">
          <div class="action-buttons">
            <button type="button" id="removeImage">Remove</button>
            <button type="button" id="changeImage">Change</button>
          </div>
        `;

        // Adiciona eventos para os botões "Remover" e "Alterar"
        document.getElementById("removeImage").addEventListener("click", removeImage);
        document.getElementById("changeImage").addEventListener("click", () => avatarInput.click());

        // Oculta a mensagem de upload após a imagem ser exibida
        infoContainer.style.display = "none";
      }

    
      // Remove a imagem carregada e restaura o estado inicial da upload-box.
      function removeImage() {
        uploadedImage = null;
        uploadBox.innerHTML = `
          <img src="./assets/images/icon-upload.svg" width="40" alt="Upload Icon">
          <span>Drag and drop or click to upload</span>
          <input type="file" accept=".jpg,.jpeg,.png" id="avatar" aria-labelledby="label-avatar">
        `;
        // Reanexa o listener para o novo input de arquivo
        const newAvatarInput = document.getElementById("avatar");
        newAvatarInput.addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (!file) return;
          if (file.size > 500 * 1024) {
            showError("Image too large! Max size is 500KB.");
            return;
          }
          if (!["image/jpeg", "image/png"].includes(file.type)) {
            showError("Formato de imagem inválido! Apenas JPG ou PNG são permitidos.");
            return;
          }
          const reader = new FileReader();
          reader.onload = function (e) {
            uploadedImage = e.target.result;
            displayImage(uploadedImage);
          };
          reader.readAsDataURL(file);
        });
        // Exibe novamente a mensagem de upload após remover a imagem
        infoContainer.style.display = "flex";
      }

      // Exibe uma mensagem de erro na info-container.
      function showError(message) {
        infoContainer.style.display = "flex";
        infoText.textContent = message;
        infoText.style.color = "red";
        infoIcon.src = "./assets/images/icon-error.svg";
      }

      /*
       - Valida os campos do formulário e exibe mensagens de erro, se necessário.
       - Se todos os campos forem válidos, os dados são armazenados e o usuário é redirecionado.
       */
      function validateForm(event) {
        event.preventDefault();

        const nameValue = nameInput.value.trim();
        const emailValue = emailInput.value.trim();
        const githubValue = githubInput.value.trim();
        let valid = true;

        // Remove mensagens de erro anteriores
        document.querySelectorAll(".error-message").forEach((el) => el.remove());
        // Remove atributo aria-invalid dos campos para limpar estados anteriores
        [avatarInput, nameInput, emailInput, githubInput].forEach(inp => {
          inp.removeAttribute("aria-invalid");
        });

        // Validação do upload de imagem
        if (!uploadedImage) {
          showFieldError(uploadBox, "Image is required!");
          valid = false;
        }

        // Validação do campo nome
        if (nameValue.length < 3) {
          showFieldError(nameInput, "O nome deve ter pelo menos 3 caracteres.");
          valid = false;
        }

        // Validação do campo email
        if (!validateEmail(emailValue)) {
          showFieldError(emailInput, "Invalid email format.");
          valid = false;
        }

        // Validação do campo GitHub username
        if (githubValue === "") {
          showFieldError(githubInput, "O username do GitHub é obrigatório.");
          valid = false;
        }

        if (valid) {
          // Armazena os dados no localStorage para uso na página do ticket
          localStorage.setItem("userName", nameValue);
          localStorage.setItem("userEmail", emailValue);
          localStorage.setItem("userGitHub", githubValue);
          localStorage.setItem("userAvatar", uploadedImage || "");

          // Redireciona para a página do ticket
          window.location.href = "ticket.html";
        }
      }

      // Exibe uma mensagem de erro para um campo específico do formulário.
      function showFieldError(inputOrBox, message) {
        const errorDiv = document.createElement("div");
        errorDiv.classList.add("error-message");
        errorDiv.setAttribute("role", "alert"); // para screen readers
        errorDiv.style.color = "red";
        errorDiv.style.fontSize = "0.85rem";
        errorDiv.style.marginTop = "5px";
        errorDiv.innerHTML = `
          <img src="./assets/images/icon-info.svg" width="12" style="margin-right: 5px;">
          ${message}
        `;

        // Se o elemento for um input, adiciona atributo aria-invalid
        if (inputOrBox.tagName === "INPUT") {
          inputOrBox.setAttribute("aria-invalid", "true");
          inputOrBox.parentNode.appendChild(errorDiv);
        } else {
          // Caso seja a upload-box
          inputOrBox.appendChild(errorDiv);
        }
      }

      // Valida o formato do email utilizando expressão regular.
      function validateEmail(email) {
        const re = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        return re.test(email);
      }

      // Associa a validação do formulário ao evento de submit
      form.addEventListener("submit", validateForm);
    });
  </script>
</body>
</html>
